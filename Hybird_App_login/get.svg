<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="957" height="1115" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[App->H5:显示指定页面
Note over H5:调用原生加密函数得到 sign
H5->App:约定数据(时间戳+版本号等)
Note over App:用AES加密 AES(token+约定数据)
App->H5:AES加密的 sign
H5->server:sign +约定数据 + 请求数据
Note over server:接口不需要验证sign，直接返回数据。
Note over server:判断时间戳是否合法?\n不合法--认证失败(请求超时)\n合法--继续认证
Note over server:sessionID得到token,判断token是否存在？
Note over server:存在\n用AES(token+约定数据)加密生成签名\n用生成签名对比sign是否相等\n是则认证成功,否则失败。
Note over server:不存在(未登录过或者session失效)\n通过AES解密得到token以及时间戳\n判断时间戳是否合法？\n不合法--认证失败\n合法(对比参数中的时间戳)--解析token得到用户信息及其过期时间\n对比当前时间和过期时间查看是否过期？\n过期 -- 则认证失败\n未过期 -- 重新生成token，重新建立sessionID/token关系映射\n并且返回。

server->H5:'\n返回登录结果\n(如果重新生成的token,则返回)
Note over H5:判断结果是否存在token?\n存在替换token
H5->App:存在token,调用App方法替换token
Note over App:替换 token
Note over H5:渲染数据,完成数据渲染]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="109" y="20" width="44" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="119" y="44" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="119">App</tspan></text></g><g class="actor"><rect x="109" y="1059.15625" width="44" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="119" y="1083.15625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="119">App</tspan></text></g><line x1="131" x2="131" y1="56" y2="1059.15625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="373" y="20" width="36" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="383" y="44" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="383">H5</tspan></text></g><g class="actor"><rect x="373" y="1059.15625" width="36" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="383" y="1083.15625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="383">H5</tspan></text></g><line x1="391" x2="391" y1="56" y2="1059.15625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="608" y="20" width="68" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="618" y="44" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="618">server</tspan></text></g><g class="actor"><rect x="608" y="1059.15625" width="68" height="36" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="618" y="1083.15625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="618">server</tspan></text></g><line x1="642" x2="642" y1="56" y2="1059.15625" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="signal"><text x="213" y="87" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="213">显示指定页面</tspan></text><line x1="131" x2="391" y1="92" y2="92" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="286" y="112" width="210" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="291" y="131" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="291">调用原生加密函数得到 sign</tspan></text></g><g class="signal"><text x="161" y="169" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="161">约定数据(时间戳+版本号等)</tspan></text><line x1="391" x2="131" y1="174" y2="174" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="10" y="194" width="242" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="15" y="213" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">用AES加密 AES(token+约定数据)</tspan></text></g><g class="signal"><text x="205" y="251" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="205">AES加密的 sign</tspan></text><line x1="131" x2="391" y1="256" y2="256" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="416.5" y="287" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="416.5">sign +约定数据 + 请求数据</tspan></text><line x1="391" x2="642" y1="292" y2="292" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="501" y="312" width="282" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="506" y="331" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="506">接口不需要验证sign，直接返回数据。</tspan></text></g><g class="note"><rect x="533" y="358" width="218" height="64.390625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="538" y="377" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="538">判断时间戳是否合法?</tspan><tspan dy="1.2em" x="538">不合法--认证失败(请求超时)</tspan><tspan dy="1.2em" x="538">合法--继续认证</tspan></text></g><g class="note"><rect x="485" y="442.390625" width="314" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="490" y="461.390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="490">sessionID得到token,判断token是否存在？</tspan></text></g><g class="note"><rect x="505" y="488.390625" width="274" height="83.59375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="510" y="507.390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="510">存在</tspan><tspan dy="1.2em" x="510">用AES(token+约定数据)加密生成签名</tspan><tspan dy="1.2em" x="510">用生成签名对比sign是否相等</tspan><tspan dy="1.2em" x="510">是则认证成功,否则失败。</tspan></text></g><g class="note"><rect x="401" y="591.984375" width="482" height="179.59375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="406" y="610.984375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="406">不存在(未登录过或者session失效)</tspan><tspan dy="1.2em" x="406">通过AES解密得到token以及时间戳</tspan><tspan dy="1.2em" x="406">判断时间戳是否合法？</tspan><tspan dy="1.2em" x="406">不合法--认证失败</tspan><tspan dy="1.2em" x="406">合法(对比参数中的时间戳)--解析token得到用户信息及其过期时间</tspan><tspan dy="1.2em" x="406">对比当前时间和过期时间查看是否过期？</tspan><tspan dy="1.2em" x="406">过期 -- 则认证失败</tspan><tspan dy="1.2em" x="406">未过期 -- 重新生成token，重新建立sessionID/token关系映射</tspan><tspan dy="1.2em" x="406">并且返回。</tspan></text></g><g class="signal"><text x="404.5" y="783.3828125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="404.5">'</tspan><tspan dy="1.2em" x="404.5">返回登录结果</tspan><tspan dy="1.2em" x="404.5">(如果重新生成的token,则返回)</tspan></text><line x1="642" x2="391" y1="845.96875" y2="845.96875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="298" y="865.96875" width="186" height="45.1875" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="303" y="884.96875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="303">判断结果是否存在token?</tspan><tspan dy="1.2em" x="303">存在替换token</tspan></text></g><g class="signal"><text x="141" y="942.15625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="141">存在token,调用App方法替换token</tspan></text><line x1="391" x2="131" y1="947.15625" y2="947.15625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="86" y="967.15625" width="90" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="91" y="986.15625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="91">替换 token</tspan></text></g><g class="note"><rect x="302" y="1013.15625" width="178" height="26" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="307" y="1032.15625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="307">渲染数据,完成数据渲染</tspan></text></g></svg>